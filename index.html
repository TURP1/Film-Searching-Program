<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <div class="row">
        <div class="col-md-12 header">
            <h1>Find the movie</h1>
        </div>
        <input class="form-control search" type="text">
    </div>
    <div class="container output">
        <!-- <template id="filmTemplate">
            <div class="film">
                <h2>{{original_title}}</h2>
                <img src={{{backdrop_path}}}>
                <p>{{overview}}</p>
        </template> -->
    </div>





    <script>
        //config

        const API_KEY = `3f7c2de3ba0c25a5eeda6588b31fa074`;

        let searchMovieUrl = `https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=`;
        const imageSearch = `https://image.tmdb.org/t/p/w500/`;
        const noImgSrc = `https://st4.depositphotos.com/14953852/24787/v/450/depositphotos_247872612-stock-illustration-no-image-available-icon-vector.jpg`;

        //movie

        function movie(data) {
            const mappingData = mapData(data)
            const html = `
            <div>
                <img class="picture" src='${mappingData.backdrop_path}'></img>
                <h2>${mappingData.title}</h2>
                <h3>${mappingData.popularity}</h3>
            </div>
            `
            return html
        };

        function mapData(data) {
            return {
                backdrop_path: getPictureUrl(),
                title: data.original_title || data.name || `Unknown`,
                popularity: data.popularity
            }
            function getPictureUrl() {
                const url = data.backdrop_path;
                if (url) {
                    return imageSearch + url;
                }
                else {
                    return noImgSrc
                };
            }
        }



        //MovieList

        class MovieList {

            drawToDom(selector) {
                this.clearlist(selector);
                selector.appendChild(this.fragment);
            };

            renderMovies(data) {
                this.data = data;
                this.fragment = document.createDocumentFragment();

                this.data.results.forEach(data => {
                    const div = document.createElement(`article`);
                    div.classList.add(`movie`);
                    div.innerHTML = movie(data);
                    this.fragment.appendChild(div);
                });
            };

            clearlist(selector) {
                selector.innerHTML = ``;
            }
        }


        //movie_service

        function getVideoByText(text) {
            if (!text) {
                return
            }
            return fetch(searchMovieUrl + text)
                .then(r => r.json())

        }

        //main

        const input = document.querySelector(`.search`);

        const movieOutput = document.querySelector(`.output`);
        const movieList = new MovieList()

        input.addEventListener(`input`, e => {
            const searchText = e.target.value;
            if (!searchText) {
                movieOutput.innerHTML = ``;
                return;
            }
            getVideoByText(searchText)
                .then(results => {
                    movieList.renderMovies(results);

                    movieList.drawToDom(movieOutput);

                });
        })

       //I should work about responcive design
    </script>



    <script src="mustache.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
</body>

</html>